<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Security Guard Panel - MEMBRO</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="../data.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .guard-header {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 32px rgba(30, 64, 175, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .guard-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .guard-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .guard-avatar:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .guard-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .shift-info {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .time-display {
            text-align: right;
        }
        
        .current-time {
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .current-date {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
        }
        
        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        /* Card Base Styles */
        .card {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981, #f59e0b);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            color: #1e293b;
        }
        
        .card-header h3 {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }
        
        .card-header i {
            font-size: 1.25rem;
            color: #3b82f6;
        }
        
        /* Stats Section */
        .stats-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
        
        .stat-item {
            text-align: center;
            padding: 1.5rem 1rem;
            border-radius: 12px;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border: 1px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--stat-color, #3b82f6);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .stat-item:hover {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .stat-item:hover::before {
            transform: scaleX(1);
        }
        
        .stat-item:nth-child(1) { --stat-color: #10b981; }
        .stat-item:nth-child(2) { --stat-color: #f59e0b; }
        .stat-item:nth-child(3) { --stat-color: #3b82f6; }
        .stat-item:nth-child(4) { --stat-color: #ef4444; }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--stat-color, #3b82f6), var(--stat-color, #3b82f6));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Scanner Section */
        .scanner-section {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
        }
        
        .scanner-button {
            width: 100%;
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.3);
        }
        
        .scanner-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .scanner-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.4);
        }
        
        .scanner-button:hover::before {
            left: 100%;
        }
        
        .scanner-button i {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            display: block;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .scanner-description {
            font-size: 0.9rem;
            color: #64748b;
            text-align: center;
            font-weight: 500;
            line-height: 1.5;
        }
        
        /* Quick Actions - Improved Layout */
        .quick-actions {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #ffffff 0%, #fefbff 100%);
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            color: #374151;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
        }
        
        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .action-btn:hover {
            border-color: transparent;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
            color: white;
        }
        
        .action-btn:hover::before {
            opacity: 1;
        }
        
        .action-btn i {
            font-size: 2.2rem;
            margin-bottom: 1rem;
            display: block;
            position: relative;
            z-index: 1;
            transition: transform 0.3s ease;
        }
        
        .action-btn:hover i {
            transform: scale(1.1);
        }
        
        .action-btn span {
            position: relative;
            z-index: 1;
            font-size: 1rem;
            font-weight: 700;
            line-height: 1.3;
        }
        
        /* Activity Feed */
        .activity-feed {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .activity-container {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .activity-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .activity-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .activity-container::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .activity-container::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            border-left: 4px solid #e2e8f0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .activity-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .activity-item.entry {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #10b981;
        }
        
        .activity-item.exit {
            background: linear-gradient(135deg, #fefbf2 0%, #fef3c7 100%);
            border-left-color: #f59e0b;
        }
        
        .activity-item.alert {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left-color: #ef4444;
        }
        
        .activity-item.pass_generated {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left-color: #3b82f6;
        }
        
        .activity-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .activity-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .activity-item:hover .activity-icon::before {
            opacity: 1;
        }
        
        .activity-icon.entry {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .activity-icon.exit {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .activity-icon.alert {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .activity-icon.pass_generated {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-person {
            font-weight: 700;
            font-size: 1rem;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        
        .activity-description {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .activity-time {
            font-size: 0.85rem;
            color: #94a3b8;
            font-weight: 600;
            background: rgba(148, 163, 184, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
        }
        
        /* Emergency Button */
        .emergency-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.6rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: emergencyPulse 3s infinite;
        }
        
        .emergency-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(239, 68, 68, 0.6);
        }
        
        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4), 0 0 0 10px rgba(239, 68, 68, 0.1); }
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            margin: 3% auto;
            padding: 2.5rem;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .close {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #94a3b8;
            transition: all 0.3s ease;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close:hover {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .guard-header {
                padding: 1rem;
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .guard-info {
                justify-content: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.75rem;
            }
            
            .stat-item {
                padding: 1rem 0.5rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .action-btn {
                padding: 1.5rem 1rem;
                min-height: 120px;
            }
            
            .action-btn i {
                font-size: 1.8rem;
                margin-bottom: 0.75rem;
            }
            
            .action-btn span {
                font-size: 0.95rem;
            }
            
            .scanner-button {
                padding: 2rem 1.5rem;
                font-size: 1.1rem;
            }
            
            .scanner-button i {
                font-size: 2rem;
            }
            
            .scanner-options {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .scanner-option {
                padding: 1.25rem;
            }
            
            .modal-content {
                margin: 5% auto;
                padding: 2rem;
                width: 95%;
            }
            
            .emergency-btn {
                bottom: 1rem;
                right: 1rem;
                width: 55px;
                height: 55px;
                font-size: 1.4rem;
            }
        }
        
        @media (max-width: 480px) {
            .guard-header {
                padding: 0.75rem;
            }
            
            .guard-title {
                font-size: 1.2rem;
            }
            
            .current-time {
                font-size: 1.2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .stat-item {
                padding: 1rem;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .action-btn {
                padding: 1.25rem 1rem;
                min-height: 100px;
            }
            
            .action-btn i {
                font-size: 1.6rem;
                margin-bottom: 0.5rem;
            }
            
            .action-btn span {
                font-size: 0.9rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .modal-content {
                padding: 1.5rem;
            }
            
            .scanner-options {
                gap: 0.75rem;
            }
            
            .scanner-option {
                padding: 1rem;
            }
            
            .scanner-option i {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .scanner-option-title {
                font-size: 0.9rem;
            }
            
            .scanner-option-desc {
                font-size: 0.8rem;
            }
        }
        
        /* Tablet Responsive */
        @media (min-width: 769px) and (max-width: 1024px) {
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.25rem;
            }
            
            .action-btn {
                padding: 1.75rem 1.25rem;
                min-height: 130px;
            }
            
            .scanner-options {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
        }
        
        /* Large Desktop */
        @media (min-width: 1200px) {
            .actions-grid {
                grid-template-columns: repeat(4, 1fr);
                max-width: 1400px;
            }
            
            .action-btn {
                padding: 2.5rem 2rem;
                min-height: 160px;
            }
            
            .action-btn i {
                font-size: 2.5rem;
                margin-bottom: 1.25rem;
            }
            
            .action-btn span {
                font-size: 1.1rem;
            }
        }

        /* Visitor Management Styles */
        .registration-step {
            min-height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .registration-type-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #e55a2b 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 2rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }
        
        .registration-type-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .registration-type-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.4);
        }
        
        .registration-type-btn:hover::before {
            left: 100%;
        }
        
        .registration-type-btn i {
            font-size: 1.5rem;
        }
        
        .back-btn {
            position: absolute;
            left: 1.5rem;
            top: 1.5rem;
            background: rgba(100, 116, 139, 0.1);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #64748b;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: rgba(100, 116, 139, 0.2);
            color: #374151;
            transform: scale(1.1);
        }
        
        .modal-header {
            color: white;
            background: linear-gradient(135deg, #ff6b35 0%, #e55a2b 100%);
            padding: 1.5rem;
            margin: -2.5rem -2.5rem 2rem -2.5rem;
            text-align: center;
            border-radius: 20px 20px 0 0;
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 700;
            color: #374151;
            font-size: 0.95rem;
        }
        
        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .photo-capture {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .photo-preview {
            width: 100%;
            height: 140px;
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            position: relative;
            overflow: hidden;
        }
        
        .photo-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(59, 130, 246, 0.05) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .photo-preview:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            transform: scale(1.02);
        }
        
        .photo-preview:hover::before {
            transform: translateX(100%);
        }
        
        .photo-preview.has-photo {
            padding: 0;
            border: 3px solid #10b981;
            background: white;
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }
        
        .photo-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 1rem 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .photo-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .register-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 1.25rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        /* Scanner Modal Styles */
        .scan-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .scan-area {
            background: linear-gradient(135deg, #ff6b35 0%, #e55a2b 100%);
            color: white;
            padding: 3.5rem 2rem;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.3);
        }
        
        .scan-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .scan-area:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 40px rgba(255, 107, 53, 0.4);
        }
        
        .scan-area:hover::before {
            opacity: 1;
        }
        
        .scan-form {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 2rem;
            border-radius: 16px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .verify-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #e55a2b 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 1.25rem;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            margin-top: 1.5rem;
        }
        
        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }
        
        /* Visitor Details View */
        .visitor-details-view {
            text-align: center;
        }
        
        .visitor-photo-large {
            margin-bottom: 2rem;
            position: relative;
        }
        
        .visitor-photo-large img {
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .visitor-info {
            text-align: left;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-item:hover {
            background: rgba(59, 130, 246, 0.05);
            margin: 0 -1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
        }
        
        .info-item strong {
            color: #374151;
            font-weight: 700;
        }
        
        .info-item span {
            color: #64748b;
            font-weight: 600;
        }
        
        .status-section {
            text-align: center;
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .status-indicator.in {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            cursor: pointer;
        }
        
        .status-indicator.in:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        .status-indicator.out {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            cursor: pointer;
        }
        
        .status-indicator.out:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
        }
        
        /* Visitor Log Styles */
        .date-filters {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }
        
        .filter-item label {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .filter-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .visitor-list {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .visitor-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .visitor-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .visitor-list::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .visitor-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .visitor-item:hover {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .visitor-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .visitor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .visitor-avatar i {
            font-size: 1.2rem;
            color: #64748b;
        }
        
        .visitor-details {
            flex: 1;
        }
        
        .visitor-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        
        .visitor-time {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .visitor-status {
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .visitor-status.in {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
        }
        
        .visitor-status.out {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        
        /* Enhanced Scanner Section */
        .scanner-section {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
        }
        
        .scanner-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .scanner-option {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .scanner-option:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .scanner-option i {
            font-size: 1.8rem;
            color: #3b82f6;
            margin-bottom: 0.75rem;
            display: block;
        }
        
        .scanner-option-title {
            font-weight: 700;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .scanner-option-desc {
            font-size: 0.85rem;
            color: #64748b;
            line-height: 1.4;
        }
        
        /* Scanner Mode Selection */
        .scanner-mode-selection {
            margin-bottom: 1.5rem;
        }
        
        .mode-tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 12px;
            padding: 0.25rem;
            gap: 0.25rem;
        }
        
        .mode-tab {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: #64748b;
        }
        
        .mode-tab.active {
            background: white;
            color: #3b82f6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mode-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .mode-tab i {
            font-size: 1rem;
        }
        
        /* OCR Processing */
        .ocr-processing {
            text-align: center;
            padding: 2rem;
            color: #64748b;
        }
        
        .ocr-processing i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #3b82f6;
        }
        
        .ocr-processing div {
            font-weight: 600;
            font-size: 1rem;
        }
        
        /* ID Card Preview */
        .id-card-preview {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 2rem;
            border: 2px solid #cbd5e1;
            margin-bottom: 1.5rem;
        }
        
        .id-card-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .id-photo {
            width: 80px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            background: #e2e8f0;
        }
        
        .id-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .id-info {
            flex: 1;
        }
        
        .id-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }
        
        .id-number {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .id-type {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .id-details {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .detail-label {
            font-weight: 600;
            color: #475569;
            font-size: 0.9rem;
        }
        
        .detail-value {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.9rem;
            text-align: right;
            max-width: 200px;
            word-wrap: break-word;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
        }

        /* Visitor Log Redesigned */
        .visitor-log-scanner {
            margin-bottom: 2rem;
        }
        
        .scanner-area {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.3);
        }
        
        .scanner-area:hover {
            transform: scale(1.02);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
        }
        
        .visitor-list-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .section-header h4 {
            color: #1e293b;
            font-weight: 700;
        }
        
        .visitor-count {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .visitor-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .visitor-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        
        .visitor-item:hover {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .visitor-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .visitor-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .visitor-avatar i {
            font-size: 1.2rem;
            color: #64748b;
        }
        
        .visitor-details {
            flex: 1;
        }
        
        .visitor-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }
        
        .visitor-time {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 500;
        }
        
        .visitor-type {
            font-size: 0.8rem;
            color: #64748b;
            font-weight: 500;
            margin-top: 0.25rem;
        }
        
        .visitor-status {
            padding: 0.5rem 1rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .visitor-status.in {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
        }
        
        .visitor-status.out {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        
        /* Quick Actions - Mobile Responsive Grid */
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            padding: 1rem;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-height: 80px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .action-btn:hover {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }
        
        .action-btn i {
            font-size: 1.5rem;
            color: #3b82f6;
            min-width: 24px;
        }
        
        .action-btn span {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
            line-height: 1.3;
        }
        
        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
                padding: 0.75rem;
            }
            
            .action-btn {
                padding: 1rem;
                min-height: 70px;
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .action-btn i {
                font-size: 1.25rem;
            }
            
            .action-btn span {
                font-size: 0.85rem;
                line-height: 1.2;
            }
        }
        
        @media (max-width: 480px) {
            .actions-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            
            .action-btn {
                padding: 1.25rem;
                min-height: 80px;
                flex-direction: row;
                text-align: left;
                gap: 1rem;
            }
            
            .action-btn i {
                font-size: 1.5rem;
            }
            
            .action-btn span {
                font-size: 0.9rem;
            }
        }

        /* Visitor Management Modal - Desktop Optimized */
        .visitor-management-modal {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .currently-in-section {
            margin-bottom: 0;
            padding: 1.5rem;
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            border-radius: 12px;
            border: 2px solid #10b981;
            height: fit-content;
        }
        
        .all-visitors-section {
            margin-top: 0;
            height: fit-content;
        }
        
        .visitor-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .currently-in-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Desktop Layout */
        @media (min-width: 769px) {
            .visitor-management-modal {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }
            
            .currently-in-section,
            .all-visitors-section {
                margin: 0;
            }
            
            .visitor-item,
            .currently-in-item {
                padding: 1rem;
                margin-bottom: 0.75rem;
            }
        }
        
        /* Mobile Layout */
        @media (max-width: 768px) {
            .visitor-management-modal {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .currently-in-section {
                margin-bottom: 1.5rem;
            }
        }
        
        /* Fix Z-Index for Visitor Details Modal */
        #visitorDetailsModal {
            z-index: 10000;
        }
        
        #idCardDetailsModal {
            z-index: 10000;
        }

        /* Visitor Details Modal - New Structure */
        .visitor-details-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .visitor-photo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border: 1px solid #cbd5e1;
        }
        
        .visitor-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .visitor-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .visitor-photo i {
            font-size: 1.5rem;
            color: #64748b;
        }
        
        .visitor-status-indicator {
            flex: 1;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .visitor-status-indicator.in {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
            color: #166534;
        }
        
        .visitor-status-indicator.out {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
        }
        
        .visitor-status-indicator.registered {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: #1e40af;
        }
        
        .visitor-info-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .info-label {
            font-weight: 600;
            color: #475569;
            font-size: 0.9rem;
        }
        
        .info-value {
            font-weight: 500;
            color: #1e293b;
            font-size: 0.9rem;
            text-align: right;
        }
        
        .visitor-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .visitor-actions .btn {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .visitor-actions .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
        }
        
        .visitor-actions .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }
        
        .visitor-actions .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }
        
        .visitor-actions .btn-secondary:hover {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(100, 116, 139, 0.3);
        }

        /* Professional Button Design */
        .mark-out-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
            min-width: 120px;
            justify-content: center;
        }
        
        .mark-out-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .mark-out-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
        }
        
        .visitor-status {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 80px;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .visitor-status.in {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: 2px solid #10b981;
        }
        
        .visitor-status.in:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .visitor-status.out {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            border: 2px solid #f59e0b;
        }
        
        .visitor-status.out:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }
        
        .visitor-status.registered {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            border: 2px solid #3b82f6;
        }
        
        .visitor-status.registered:hover {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .visitor-status.verified {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border: 2px solid #8b5cf6;
        }
        
        .visitor-status.verified:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        /* Navigation Tabs - Professional Colors */
        .nav-tabs {
            display: flex;
            background: #f8fafc;
            border-radius: 12px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            border: 2px solid #e2e8f0;
        }
        
        .nav-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            color: #64748b;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .nav-tab:hover {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .nav-tab.active:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }
    </style>
</head>
<body>
    <!-- Guard Header -->
    <div class="guard-header">
        <div class="guard-info">
            <div class="guard-avatar">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div>
                <h3 class="guard-title">Security Guard Panel</h3>
                <div class="shift-info" id="shiftInfo">Day Shift • 6:00 AM - 6:00 PM</div>
            </div>
        </div>
        <div class="time-display">
            <div id="currentTime" class="current-time"></div>
            <div id="currentDate" class="current-date"></div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Today's Stats -->
            <div class="card stats-section">
                <div class="card-header">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Today's Activity</h3>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="entriesCount">0</div>
                        <div class="stat-label">Entries</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="exitsCount">0</div>
                        <div class="stat-label">Exits</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="visitorsCount">0</div>
                        <div class="stat-label">Visitors</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="alertsCount">0</div>
                        <div class="stat-label">Alerts</div>
                    </div>
                </div>
            </div>

         

            <!-- OCR Scanner -->
            <div class="card scanner-section">
                <div class="card-header">
                    <i class="fas fa-id-card"></i>
                    <h3>ID Card Scanner</h3>
                </div>
                <button class="scanner-button" onclick="openOCRScanner()">
                    <i class="fas fa-camera"></i>
                    Scan ID Card
                </button>
                <div class="scanner-description">
                    Scan ID cards to extract visitor information
                </div>
            </div>
        </div>

        <!-- Quick Actions - Simplified -->
        <div class="card quick-actions">
            <div class="card-header">
                <i class="fas fa-bolt"></i>
                <h3>Navigation</h3>
            </div>
            <div class="actions-grid">
                <button class="action-btn" onclick="generateVisitorPass()">
                    <i class="fas fa-id-card"></i>
                    <span>Register New Visitor</span>
                </button>
                <button class="action-btn" onclick="openPreRegisteredLog()">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pre-Registered Visitors</span>
                </button>
                <button class="action-btn" onclick="openVisitorLog()">
                    <i class="fas fa-users"></i>
                    <span>Visitor Log</span>
                </button>
                <button class="action-btn" onclick="logIncident()">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Log Incident</span>
                </button>
            </div>
        </div>

        <!-- Live Activity Feed -->
        <div class="card activity-feed">
            <div class="card-header">
                <i class="fas fa-stream"></i>
                <h3>Live Activity Feed</h3>
            </div>
            <div class="activity-container">
                <div id="activityFeed">
                    <!-- Activity items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Button -->
    <button class="emergency-btn" onclick="triggerEmergency()" title="Emergency Alert">
        <i class="fas fa-exclamation"></i>
    </button>

    <!-- QR Scanner Modal -->
    <div id="scannerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeScanner()">&times;</span>
            <h3 style="text-align: center; margin-top: 0;">
                <i class="fas fa-camera"></i>
                Universal Scanner
            </h3>
            
            <!-- Scanner Mode Selection -->
            <div class="scanner-mode-selection">
                <div class="mode-tabs">
                    <button class="mode-tab active" onclick="switchScannerMode('qr')" id="qrModeTab">
                        <i class="fas fa-qrcode"></i>
                        QR Code
                    </button>
                    <button class="mode-tab" onclick="switchScannerMode('ocr')" id="ocrModeTab">
                        <i class="fas fa-id-card"></i>
                        ID Card (OCR)
                    </button>
                </div>
            </div>
            
            <div class="scanner-container">
                <div id="reader"></div>
                <div id="ocrResult" style="display: none;">
                    <div class="ocr-processing">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div>Processing ID Card...</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem; color: #64748b; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    <span id="scannerInstructions">Position QR code within the scanning area</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Visitor Registration Modal -->
    <div id="visitorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVisitorModal()">&times;</span>
            <h3 style="text-align: center; margin-top: 0;">
                <i class="fas fa-user-plus"></i>
                Register Visitor
            </h3>
            
            <!-- Step 1: Choose Registration Type -->
            <div id="registrationTypeStep" class="registration-step">
                <div style="display: grid; gap: 1.5rem; margin: 2rem 0;">
                    <button class="registration-type-btn" onclick="showVisitorDetailsForm()">
                        <i class="fas fa-user"></i>
                        Register Visitor Information
                    </button>
                    <button class="registration-type-btn" onclick="showCarDetailsForm()">
                        <i class="fas fa-car"></i>
                        Register Visitor Car Details
                    </button>
                </div>
            </div>

            <!-- Step 2: Visitor Details Form -->
            <div id="visitorDetailsStep" class="registration-step" style="display: none;">
                <div class="back-btn" onclick="showRegistrationType()">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <h4 class="modal-header">
                    Register Visitor Details
                </h4>
                <form id="visitorDetailsForm">
                    <div class="form-group">
                        <label class="form-label">Visitor Name:</label>
                        <input type="text" id="visitorNameDetails" class="form-input" required placeholder="Enter full name">
                    </div>
                     <div class="form-group">
                        <label class="form-label">Phone Number:</label>
                        <input type="tel" id="visitorEmail" class="form-input" required placeholder="Enter phone number">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address:</label>
                        <input type="email" id="visitorEmail" class="form-input" required placeholder="Enter email addess">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Visitor Photo:</label>
                        <div class="photo-capture">
                            <div id="photoPreview" class="photo-preview" onclick="captureVisitorPhoto()">
                                <i class="fas fa-camera" style="font-size: 2.5rem; color: #64748b;"></i>
                                <div style="margin-top: 0.75rem; font-size: 0.95rem; color: #64748b; font-weight: 600;">Tap to capture photo</div>
                            </div>
                            <button type="button" class="photo-btn" onclick="captureVisitorPhoto()">
                                <i class="fas fa-id-card"></i>
                                Capture ID Card
                            </button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="submit" class="register-btn">
                            <i class="fas fa-check"></i>
                            Register
                        </button>
                        <button type="button" class="cancel-btn" onclick="showRegistrationType()">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                    </div>
                </form>
            </div>

            <!-- Step 3: Car Details Form -->
            <div id="carDetailsStep" class="registration-step" style="display: none;">
                <div class="back-btn" onclick="showRegistrationType()">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <h4 class="modal-header">
                    Register Visitor Car Details
                </h4>
                <form id="carDetailsForm">
                    <div class="form-group">
                        <label class="form-label">Owner Name/Visitor Name:</label>
                        <input type="text" id="carOwnerName" class="form-input" required placeholder="Input Full Name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vehicle Name:</label>
                        <input type="text" id="vehicleName" class="form-input" required placeholder="Input Vehicle Name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vehicle Maker:</label>
                        <select id="vehicleMaker" class="form-select" required>
                            <option value="">Select Car</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Honda">Honda</option>
                            <option value="Nissan">Nissan</option>
                            <option value="Mitsubishi">Mitsubishi</option>
                            <option value="Hyundai">Hyundai</option>
                            <option value="Ford">Ford</option>
                            <option value="Chevrolet">Chevrolet</option>
                            <option value="BMW">BMW</option>
                            <option value="Mercedes">Mercedes</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vehicle Color:</label>
                        <input type="text" id="vehicleColor" class="form-input" required placeholder="Input Vehicle Color">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Plate No.:</label>
                        <input type="text" id="plateNumber" class="form-input" required placeholder="Input Plate Number">
                    </div>
                    <div class="button-group">
                        <button type="submit" class="register-btn">
                            <i class="fas fa-check"></i>
                            Register
                        </button>
                        <button type="button" class="cancel-btn" onclick="showRegistrationType()">
                            <i class="fas fa-times"></i>
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Visitor Scan Modal -->
    <div id="visitorScanModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeVisitorScan()">&times;</span>
            <div class="back-btn" onclick="closeVisitorScan()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <div class="scan-section">
                <div class="scan-area" onclick="simulateVisitorScan()">
                    <i class="fas fa-qrcode" style="font-size: 3.5rem; color: white;"></i>
                    <div style="margin-top: 1rem; color: white; font-weight: 700; font-size: 1.3rem;">SCAN</div>
                </div>
            </div>

            <div class="scan-form">
                <div class="form-group">
                    <label class="form-label">Visit Code:</label>
                    <input type="text" id="visitCode" class="form-input" placeholder="Input Visit Code">
                </div>
                <div class="form-group">
                    <label class="form-label">Name:</label>
                    <input type="text" id="scanVisitorName" class="form-input" readonly style="background: #f1f5f9;">
                </div>
                <div style="margin-bottom: 1rem; font-size: 0.95rem; color: #64748b; font-weight: 600;">
                    <strong>Visit Date:</strong> <span id="visitDate"></span>
                </div>
                <div class="form-group">
                    <label class="form-label">Purpose:</label>
                    <select id="scanPurpose" class="form-select">
                        <option value="">Select Purpose</option>
                        <option value="Personal Visit">Personal Visit</option>
                        <option value="Delivery">Delivery</option>
                        <option value="Service/Repair">Service/Repair</option>
                        <option value="Official Business">Official Business</option>
                    </select>
                </div>
                <button class="verify-btn" onclick="verifyVisitor()">
                    <i class="fas fa-check-circle"></i>
                    Verify
                </button>
            </div>
        </div>
    </div>

    <!-- Visitor Details Modal -->
    <div id="visitorDetailsModal" class="modal" style="z-index: 10000;">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeVisitorDetails()">&times;</span>
            <div class="back-btn" onclick="closeVisitorDetails()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 class="modal-header">
                <i class="fas fa-user"></i>
                Visitor Details
            </h3>
            
            <div class="visitor-details-content">
                <div class="visitor-photo-section">
                    <div class="visitor-photo" id="visitorDetailPhoto">
                        <!-- Photo will be populated here -->
                    </div>
                    <div class="visitor-status-indicator" id="visitorStatusIndicator">
                        <!-- Status will be populated here -->
                    </div>
                </div>
                
                <div class="visitor-info-section">
                    <div class="info-row">
                        <span class="info-label">Name:</span>
                        <span class="info-value" id="visitorDetailName"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Purpose:</span>
                        <span class="info-value" id="visitorDetailPurpose"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Entry Time:</span>
                        <span class="info-value" id="visitorDetailEntryTime"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Type:</span>
                        <span class="info-value" id="visitorDetailType"></span>
                    </div>
                </div>
                
                <div class="visitor-actions">
                    <button class="btn btn-primary" onclick="processVisitorEntry()" id="processEntryBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        Mark In
                    </button>
                    <button class="btn btn-secondary" onclick="closeVisitorDetails()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Visitor Log Modal - Redesigned -->
    <div id="visitorLogModal" class="modal">
        <div class="modal-content" style="max-width: 1000px;">
            <span class="close" onclick="closeVisitorLog()">&times;</span>
            <div class="back-btn" onclick="closeVisitorLog()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 class="modal-header">
                Visitor Management
            </h3>
            
            <div class="visitor-management-modal">
                <!-- Currently In Visitors -->
                <div class="currently-in-section">
                    <div class="section-subheader">
                        <h5 style="margin: 0; color: #059669; font-weight: 700;">
                            <i class="fas fa-sign-in-alt"></i>
                            Currently In (<span id="currentlyInCount">0</span>)
                        </h5>
                    </div>
                    <div class="currently-in-list" id="currentlyInList">
                        <!-- Currently in visitors will be populated here -->
                    </div>
                </div>
                
                <!-- All Visitors -->
                <div class="all-visitors-section">
                    <div class="section-subheader">
                        <h5 style="margin: 0; color: #1e293b; font-weight: 700;">
                            <i class="fas fa-users"></i>
                            All Visitors
                        </h5>
                    </div>
                    <div class="visitor-list" id="visitorList">
                        <!-- Visitor items will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Scanner in Log Modal -->
    <div id="qrScannerInLogModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQRScannerInLog()">&times;</span>
            <div class="back-btn" onclick="closeQRScannerInLog()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 style="text-align: center; margin-top: 0;">
                <i class="fas fa-camera"></i>
                Scan Visitor QR Code
            </h3>
            
            <div class="scanner-container">
                <div id="readerInLog"></div>
                <div style="text-align: center; margin-top: 1rem; color: #64748b; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Position QR code within the scanning area
                </div>
            </div>
        </div>
    </div>

    <!-- OCR Scanner Modal -->
    <div id="ocrScannerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOCRScanner()">&times;</span>
            <div class="back-btn" onclick="closeOCRScanner()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 style="text-align: center; margin-top: 0;">
                <i class="fas fa-id-card"></i>
                Scan ID Card
            </h3>
            
            <div class="scanner-container">
                <div id="ocrReader"></div>
                <div style="text-align: center; margin-top: 1rem; color: #64748b; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Position ID card within the scanning area
                </div>
            </div>
            
            <!-- Demo Button Inside Scanner -->
            <div class="demo-section">
                <div class="demo-divider">
                    <span>OR</span>
                </div>
                <button class="demo-button" onclick="demoOCRScan()">
                    <i class="fas fa-play"></i>
                    Demo Scan
                </button>
                <div class="demo-description">
                    Test the scanning functionality without a camera
                </div>
            </div>
        </div>
    </div>

    <!-- ID Card Details Modal -->
    <div id="idCardDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close" onclick="closeIDCardDetails()">&times;</span>
            <div class="back-btn" onclick="closeIDCardDetails()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 class="modal-header">
                <i class="fas fa-id-card"></i>
                ID Card Details
            </h3>
            
            <div class="id-card-preview">
                <div class="id-card-header">
                    <div class="id-photo">
                        <img id="idPhoto" src="" alt="ID Photo">
                    </div>
                    <div class="id-info">
                        <div class="id-name" id="idName"></div>
                        <div class="id-number" id="idNumber"></div>
                        <div class="id-type" id="idType"></div>
                    </div>
                </div>
                
                <div class="id-details">
                    <div class="detail-row">
                        <span class="detail-label">Full Name:</span>
                        <span class="detail-value" id="fullName"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Address:</span>
                        <span class="detail-value" id="address"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Date of Birth:</span>
                        <span class="detail-value" id="dateOfBirth"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ID Number:</span>
                        <span class="detail-value" id="idNumberDetail"></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Nationality:</span>
                        <span class="detail-value" id="nationality"></span>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="registerFromIDCard()">
                        <i class="fas fa-user-plus"></i>
                        Register as Visitor
                    </button>
                    <button class="btn btn-secondary" onclick="closeIDCardDetails()">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pre-Registered Visitors Modal -->
    <div id="preRegisteredModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closePreRegisteredLog()">&times;</span>
            <div class="back-btn" onclick="closePreRegisteredLog()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 class="modal-header">
                Pre-Registered Visitors
            </h3>
            
            <!-- QR Scanner Section -->
            <div class="visitor-log-scanner">
                <div class="scanner-area" onclick="openQRScannerInPreRegistered()">
                    <i class="fas fa-qrcode" style="font-size: 3rem; color: white;"></i>
                    <div style="margin-top: 1rem; color: white; font-weight: 700; font-size: 1.2rem;">SCAN QR CODE</div>
                    <div style="margin-top: 0.5rem; color: rgba(255,255,255,0.8); font-size: 0.9rem;">Tap to scan pre-registered visitor QR</div>
                </div>
            </div>
            
            <!-- Pre-Registered Visitor List -->
            <div class="visitor-list-section">
                <div class="section-header">
                    <h4 style="margin: 0; color: #1e293b;">Pre-Registered Visitors</h4>
                    <div class="visitor-count">Total: <span id="preRegisteredCount">0</span></div>
                </div>
                
                <div class="visitor-list" id="preRegisteredList">
                    <!-- Pre-registered visitor items will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- QR Scanner in Pre-Registered Modal -->
    <div id="qrScannerInPreRegisteredModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQRScannerInPreRegistered()">&times;</span>
            <div class="back-btn" onclick="closeQRScannerInPreRegistered()">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <h3 style="text-align: center; margin-top: 0;">
                <i class="fas fa-camera"></i>
                Scan Pre-Registered Visitor QR
            </h3>
            
            <div class="scanner-container">
                <div id="readerInPreRegistered"></div>
                <div style="text-align: center; margin-top: 1rem; color: #64748b; font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i>
                    Position QR code within the scanning area
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let html5QrcodeScanner = null;
        let currentScanData = null;
        let activityLog = [];
        let currentScannerMode = 'qr'; // 'qr' or 'ocr'

        // Initialize dashboard with sample data
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            // Initialize with sample data for demonstration
            initializeSampleData();
            
            loadTodayStats();
            loadActivityFeed();
        });

        // Initialize sample data for demonstration
        function initializeSampleData() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            // Sample activities for today
            activityLog = [
                {
                    id: Date.now() - 300000,
                    type: 'entry',
                    category: 'resident',
                    person: 'John Smith',
                    unit: 'Unit 205',
                    timestamp: new Date(today.getTime() + 8 * 60 * 60 * 1000).toISOString(), // 8 AM
                    scanData: 'RESIDENT|JOHN_SMITH|205'
                },
                {
                    id: Date.now() - 240000,
                    type: 'entry',
                    category: 'visitor',
                    person: 'Maria Garcia',
                    unit: 'Unit 312',
                    timestamp: new Date(today.getTime() + 9 * 60 * 60 * 1000).toISOString(), // 9 AM
                    scanData: 'VISITOR|MARIA_GARCIA|312|Personal Visit'
                },
                {
                    id: Date.now() - 180000,
                    type: 'exit',
                    category: 'resident',
                    person: 'Sarah Johnson',
                    unit: 'Unit 118',
                    timestamp: new Date(today.getTime() + 10 * 60 * 60 * 1000).toISOString(), // 10 AM
                    scanData: 'RESIDENT|SARAH_JOHNSON|118'
                },
                {
                    id: Date.now() - 120000,
                    type: 'entry',
                    category: 'visitor',
                    person: 'Delivery Service',
                    unit: 'Unit 205',
                    timestamp: new Date(today.getTime() + 11 * 60 * 60 * 1000).toISOString(), // 11 AM
                    scanData: 'VISITOR|DELIVERY|205|Delivery'
                },
                {
                    id: Date.now() - 60000,
                    type: 'pass_generated',
                    category: 'visitor',
                    person: 'David Wilson',
                    unit: 'Unit 401',
                    timestamp: new Date(today.getTime() + 12 * 60 * 60 * 1000).toISOString(), // 12 PM
                    purpose: 'Service/Repair'
                }
            ];
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Load today's statistics
        function loadTodayStats() {
            const today = new Date().toDateString();
            const todayActivities = activityLog.filter(activity => 
                new Date(activity.timestamp).toDateString() === today
            );

            // Calculate stats
            const entries = todayActivities.filter(a => a.type === 'entry').length;
            const exits = todayActivities.filter(a => a.type === 'exit').length;
            const visitors = todayActivities.filter(a => a.category === 'visitor').length;
            const alerts = todayActivities.filter(a => a.type === 'alert').length;

            // Update display with sample data
            document.getElementById('entriesCount').textContent = entries || 3;
            document.getElementById('exitsCount').textContent = exits || 1;
            document.getElementById('visitorsCount').textContent = visitors || 2;
            document.getElementById('alertsCount').textContent = alerts || 0;
        }

        // Open QR Scanner
        function openScanner() {
            document.getElementById('scannerModal').style.display = 'block';
            startScanner();
        }

        // Close QR Scanner
        function closeScanner() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch(err => console.log('Scanner stop error:', err));
            }
            document.getElementById('scannerModal').style.display = 'none';
            document.getElementById('scanResult').style.display = 'none';
        }

        // Start QR Scanner with OCR capability
        function startScanner() {
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };

            html5QrcodeScanner = new Html5Qrcode("reader");
            
            html5QrcodeScanner.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                    if (currentScannerMode === 'qr') {
                        handleScanSuccess(decodedText);
                    } else {
                        handleOCRScan(decodedResult);
                    }
                },
                (errorMessage) => {
                    // Handle scan errors silently
                }
            ).catch(err => {
                console.log('Scanner start error:', err);
                showToast('Camera not available. Please use file upload.', 'warning');
            });
        }

        // Handle OCR scan (simulated ID card processing)
        function handleOCRScan(scanResult) {
            // Show OCR processing
            document.getElementById('reader').style.display = 'none';
            document.getElementById('ocrResult').style.display = 'block';
            
            // Simulate OCR processing time
            setTimeout(() => {
                // Simulate extracted ID card data
                const idData = simulateIDCardExtraction();
                
                // Show ID card preview
                showIDCardPreview(idData);
                
                // Process the extracted data
                setTimeout(() => {
                    processIDCardData(idData);
                }, 2000);
            }, 1500);
        }

        // Simulate ID card data extraction
        function simulateIDCardExtraction() {
            const sampleNames = [
                'Juan Dela Cruz',
                'Maria Santos Garcia',
                'Pedro Rodriguez',
                'Ana Martinez Lopez',
                'Carlos Fernandez'
            ];
            
            const sampleAddresses = [
                '123 Main Street, Quezon City',
                '456 Rizal Avenue, Manila',
                '789 Bonifacio Street, Makati',
                '321 EDSA, Mandaluyong',
                '654 Commonwealth Ave, QC'
            ];
            
            const randomName = sampleNames[Math.floor(Math.random() * sampleNames.length)];
            const randomAddress = sampleAddresses[Math.floor(Math.random() * sampleAddresses.length)];
            
            return {
                name: randomName,
                address: randomAddress,
                idNumber: 'ID-' + Math.random().toString(36).substring(2, 8).toUpperCase(),
                birthDate: '1990-' + (Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0') + '-' + (Math.floor(Math.random() * 28) + 1).toString().padStart(2, '0'),
                nationality: 'Filipino',
                sex: Math.random() > 0.5 ? 'M' : 'F',
                bloodType: ['A+', 'B+', 'O+', 'AB+'][Math.floor(Math.random() * 4)],
                validUntil: '2028-' + (Math.floor(Math.random() * 12) + 1).toString().padStart(2, '0') + '-' + (Math.floor(Math.random() * 28) + 1).toString().padStart(2, '0'),
                photo: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMzAiIGZpbGw9IiNlNWU3ZWIiLz4KPGNpcmNsZSBjeD0iMzAiIGN5PSIyMCIgcj0iOCIgZmlsbD0iIzM3NDE1MSIvPgo8cGF0aCBkPSJNMTAgNDBDMTAgMzEuNzE2NCAxNi43MTY0IDI1IDI1IDI1SDM1QzQzLjI4MzYgMjUgNTAgMzEuNzE2NCA1MCA0MFY0NUgxMFY0MFoiIGZpbGw9IiMzNzQxNTEiLz4KPC9zdmc+Cg=='
            };
        }

        // Show ID card preview
        function showIDCardPreview(idData) {
            const ocrResult = document.getElementById('ocrResult');
            ocrResult.innerHTML = `
                <div class="id-card-preview">
                    <div class="id-card-header">
                        <div class="id-card-photo">
                            <img src="${idData.photo}" alt="ID Photo" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                        </div>
                        <div class="id-card-info">
                            <div class="id-card-name">${idData.name}</div>
                            <div class="id-card-details">${idData.nationality} • ${idData.sex} • ${idData.bloodType}</div>
                        </div>
                    </div>
                    <div class="id-card-footer">
                        <div class="id-card-number">ID: ${idData.idNumber}</div>
                        <div class="id-card-validity">Valid until: ${idData.validUntil}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <div style="font-weight: 600; color: #10b981; margin-bottom: 0.5rem;">
                        <i class="fas fa-check-circle"></i>
                        ID Card Successfully Scanned
                    </div>
                    <div style="font-size: 0.9rem; color: #64748b;">
                        Processing visitor registration...
                    </div>
                </div>
            `;
        }

        // Process ID card data and create visitor
        function processIDCardData(idData) {
            // Create visitor object from ID card data
            const visitor = {
                id: Date.now(),
                name: idData.name,
                visitCode: generateVisitCode(),
                purpose: 'Ad-hoc Visit',
                unit: 'N/A',
                timestamp: new Date().toISOString(),
                status: 'verified',
                verifiedAt: new Date().toISOString(),
                idCardData: idData,
                type: 'adhoc_visitor'
            };
            
            // Add to registered visitors
            registeredVisitors.unshift(visitor);
            
            // Show visitor details
            setTimeout(() => {
                showVisitorDetails(visitor);
                showToast(`Ad-hoc visitor registered: ${idData.name}`, 'success');
                
                // Reset scanner
                document.getElementById('reader').style.display = 'block';
                document.getElementById('ocrResult').style.display = 'none';
                closeScanner();
            }, 1000);
        }

        // Handle successful scan
        function handleScanSuccess(decodedText) {
            currentScanData = decodedText;
            
            // Parse QR code data and directly show visitor details
            parseQRDataAndShowDetails(decodedText);
            
            // Stop scanner and close scanner modal
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop();
            }
            closeScanner();
        }

        // Parse QR code data and show visitor details directly
        function parseQRDataAndShowDetails(qrData) {
            try {
                // Parse QR data (format: VISITOR|NAME|UNIT|PURPOSE|TIMESTAMP or similar)
                if (qrData.includes('VISITOR|')) {
                    const parts = qrData.split('|');
                    const visitorName = parts[1] || 'Unknown Visitor';
                    const unit = parts[2] || 'N/A';
                    const purpose = parts[3] || 'Visit';
                    const timestamp = parts[4] || new Date().toISOString();
                    const visitCode = parts[5] || generateVisitCodeFromData(visitorName, timestamp);
                    
                    // Create visitor object for display
                    const visitor = {
                        id: Date.now(),
                        name: visitorName,
                        visitCode: visitCode,
                        purpose: purpose,
                        unit: unit,
                        timestamp: timestamp,
                        status: 'verified',
                        verifiedAt: new Date().toISOString()
                    };
                    
                    // Show visitor details directly
                    setTimeout(() => {
                        showVisitorDetails(visitor);
                        showToast(`Visitor data loaded: ${visitorName}`, 'success');
                    }, 300);
                    
                } else if (qrData.includes('RESIDENT|')) {
                    const parts = qrData.split('|');
                    const residentName = parts[1] || 'Unknown Resident';
                    const unit = parts[2] || 'N/A';
                    
                    // Create resident object for display
                    const visitor = {
                        id: Date.now(),
                        name: residentName + ' (Resident)',
                        visitCode: generateVisitCodeFromData(residentName, new Date().toISOString()),
                        purpose: 'Resident Entry',
                        unit: unit,
                        timestamp: new Date().toISOString(),
                        status: 'verified',
                        verifiedAt: new Date().toISOString()
                    };
                    
                    // Show visitor details directly
                    setTimeout(() => {
                        showVisitorDetails(visitor);
                        showToast(`Resident data loaded: ${residentName}`, 'success');
                    }, 300);
                    
                } else {
                    // Try to find matching visitor from registered visitors
                    const matchingVisitor = registeredVisitors.find(v => 
                        v.visitCode === qrData || qrData.includes(v.visitCode)
                    );
                    
                    if (matchingVisitor) {
                        // Update visitor with verification time
                        matchingVisitor.verifiedAt = new Date().toISOString();
                        matchingVisitor.status = 'verified';
                        
                        setTimeout(() => {
                            showVisitorDetails(matchingVisitor);
                            showToast(`Visitor data loaded: ${matchingVisitor.name}`, 'success');
                        }, 300);
                    } else {
                        // Generate sample data for demo
                        const sampleNames = ['John Doe', 'Maria Santos', 'David Wilson', 'Sarah Johnson', 'Michael Brown'];
                        const samplePurposes = ['Personal Visit', 'Delivery', 'Service/Repair', 'Official Business'];
                        const randomName = sampleNames[Math.floor(Math.random() * sampleNames.length)];
                        const randomPurpose = samplePurposes[Math.floor(Math.random() * samplePurposes.length)];
                        
                        const visitor = {
                            id: Date.now(),
                            name: randomName,
                            visitCode: generateVisitCode(),
                            purpose: randomPurpose,
                            unit: 'Unit ' + Math.floor(Math.random() * 500 + 100),
                            timestamp: new Date().toISOString(),
                            status: 'verified',
                            verifiedAt: new Date().toISOString()
                        };
                        
                        setTimeout(() => {
                            showVisitorDetails(visitor);
                            showToast(`Sample visitor data generated: ${randomName}`, 'info');
                        }, 300);
                    }
                }
            } catch (error) {
                console.error('Error parsing QR data:', error);
                showToast('Error reading QR code data', 'warning');
            }
        }

        // Generate visit code from visitor data
        function generateVisitCodeFromData(name, timestamp) {
            const nameCode = name.substring(0, 2).toUpperCase();
            const timeCode = new Date(timestamp).getTime().toString().slice(-4);
            const randomCode = Math.random().toString(36).substring(2, 4).toUpperCase();
            return nameCode + timeCode.substring(0, 2) + randomCode;
        }

        // Simulate visitor scan (updated to use real data)
        function simulateVisitorScan() {
            // Simulate different types of QR codes
            const qrTypes = [
                'VISITOR|John Smith|Unit 205|Personal Visit|' + new Date().toISOString(),
                'VISITOR|Maria Garcia|Unit 312|Delivery|' + new Date().toISOString(),
                'RESIDENT|Sarah Johnson|Unit 118|' + new Date().toISOString(),
                'VISITOR|David Wilson|Unit 401|Service/Repair|' + new Date().toISOString()
            ];
            
            // If we have registered visitors, use one of them
            if (registeredVisitors.length > 0) {
                const randomVisitor = registeredVisitors[Math.floor(Math.random() * registeredVisitors.length)];
                const qrData = `VISITOR|${randomVisitor.name}|Unit ${Math.floor(Math.random() * 500 + 100)}|${randomVisitor.purpose || 'Visit'}|${randomVisitor.timestamp}`;
                
                // Open visitor scan modal and populate fields
                openVisitorScan();
                setTimeout(() => {
                    document.getElementById('visitCode').value = randomVisitor.visitCode;
                    document.getElementById('scanVisitorName').value = randomVisitor.name;
                    document.getElementById('scanPurpose').value = randomVisitor.purpose || 'Visit';
                    
                    if (randomVisitor.plateNumber) {
                        const plateInfo = document.createElement('div');
                        plateInfo.innerHTML = `<strong>Plate No.:</strong> ${randomVisitor.plateNumber}`;
                        plateInfo.style.cssText = 'margin: 0.5rem 0; font-size: 0.95rem; color: #64748b; font-weight: 600;';
                        
                        const purposeDiv = document.getElementById('scanPurpose').parentNode;
                        purposeDiv.parentNode.insertBefore(plateInfo, purposeDiv);
                    }
                    
                    showToast(`Visitor data loaded: ${randomVisitor.name}`, 'success');
                }, 300);
            } else {
                // Use sample QR data
                const randomQR = qrTypes[Math.floor(Math.random() * qrTypes.length)];
                
                // Open visitor scan modal and populate fields
                openVisitorScan();
                setTimeout(() => {
                    const sampleCode = generateVisitCode();
                    const sampleName = 'Dummy Person';
                    const samplePurpose = 'Personal Visit';
                    
                    document.getElementById('visitCode').value = sampleCode;
                    document.getElementById('scanVisitorName').value = sampleName;
                    document.getElementById('scanPurpose').value = samplePurpose;
                    
                    showToast(`Sample visitor data generated: ${sampleName}`, 'info');
                }, 300);
            }
        }

        // Process scan result
        function processScanResult() {
            if (!currentScanData) return;

            // Simulate processing based on scan data
            let activityType, person, unit, category;
            
            if (currentScanData.includes('VISITOR')) {
                category = 'visitor';
                activityType = 'entry';
                person = 'Visitor';
                unit = 'N/A';
            } else if (currentScanData.includes('RESIDENT')) {
                category = 'resident';
                activityType = Math.random() > 0.5 ? 'entry' : 'exit';
                person = 'Resident';
                unit = 'Unit ' + Math.floor(Math.random() * 500 + 100);
            } else {
                // Generic processing
                category = 'visitor';
                activityType = 'entry';
                person = 'Unknown Person';
                unit = 'N/A';
            }

            // Add to activity log
            const activity = {
                id: Date.now(),
                type: activityType,
                category: category,
                person: person,
                unit: unit,
                timestamp: new Date().toISOString(),
                scanData: currentScanData
            };

            activityLog.unshift(activity);
            loadActivityFeed();
            loadTodayStats();
            
            showToast(`${activityType.toUpperCase()} logged for ${person}`, 'success');
            closeScanner();
        }

        // Visitor Management Functions
        let currentVisitorPhoto = null;
        let registeredVisitors = [
            {
                id: 1,
                name: "Maria Santos Garcia",
                phone: "+63 912 345 6789",
                purpose: "Meeting with Property Manager",
                type: "pre_registered",
                photo: "https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=200&fit=crop&crop=face",
                timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(), // 2 hours ago
                status: "in",
                entryTime: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                exitTime: null,
                qrData: "VISITOR:Maria Santos Garcia:pre_registered:meeting"
            },
            {
                id: 2,
                name: "Juan Dela Cruz",
                phone: "+63 923 456 7890",
                purpose: "Delivery Service",
                type: "adhoc_visitor",
                photo: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=200&fit=crop&crop=face",
                timestamp: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(), // 1 hour ago
                status: "in",
                entryTime: new Date(Date.now() - 1 * 60 * 60 * 1000).toISOString(),
                exitTime: null,
                idNumber: "1234-5678-9012-3456",
                address: "456 Rizal Ave., Makati City, Metro Manila",
                dateOfBirth: "March 15, 1985",
                nationality: "Filipino"
            }
        ];

        // Generate visitor pass (updated)
        function generateVisitorPass() {
            document.getElementById('visitorModal').style.display = 'block';
            showRegistrationType();
        }

        // Show registration type selection
        function showRegistrationType() {
            document.getElementById('registrationTypeStep').style.display = 'block';
            document.getElementById('visitorDetailsStep').style.display = 'none';
            document.getElementById('carDetailsStep').style.display = 'none';
        }

        // Show visitor details form
        function showVisitorDetailsForm() {
            document.getElementById('registrationTypeStep').style.display = 'none';
            document.getElementById('visitorDetailsStep').style.display = 'block';
            document.getElementById('carDetailsStep').style.display = 'none';
        }

        // Show car details form
        function showCarDetailsForm() {
            document.getElementById('registrationTypeStep').style.display = 'none';
            document.getElementById('visitorDetailsStep').style.display = 'none';
            document.getElementById('carDetailsStep').style.display = 'block';
        }

        // Close visitor modal
        function closeVisitorModal() {
            document.getElementById('visitorModal').style.display = 'none';
            resetVisitorForms();
        }

        // Reset visitor forms
        function resetVisitorForms() {
            document.getElementById('visitorDetailsForm').reset();
            document.getElementById('carDetailsForm').reset();
            currentVisitorPhoto = null;
            document.getElementById('photoPreview').innerHTML = `
                <i class="fas fa-camera" style="font-size: 2rem; color: #64748b;"></i>
                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #64748b;">Tap to capture photo</div>
            `;
            document.getElementById('photoPreview').classList.remove('has-photo');
        }

        // Capture visitor photo
        function captureVisitorPhoto() {
            // Simulate photo capture with a sample ID card image
            const samplePhoto = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjM0I4MkY2Ii8+CjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxMDAiIGZpbGw9IndoaXRlIiByeD0iNCIvPgo8Y2lyY2xlIGN4PSI1MCIgY3k9IjQwIiByPSIxNSIgZmlsbD0iI0U1RTdFQiIvPgo8cmVjdCB4PSI4MCIgeT0iMjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iOCIgZmlsbD0iIzM3NDE1MSIvPgo8cmVjdCB4PSI4MCIgeT0iMzUiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2IiBmaWxsPSIjNjQ3NDhCIi8+CjxyZWN0IHg9IjgwIiB5PSI0OCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjYiIGZpbGw9IiM2NDc0OEIiLz4KPHR5cGUgeD0iMjAiIHk9Ijg1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiMzNzQxNTEiPklEIENBUkQ8L3RleHQ+Cjwvc3ZnPgo=';
            
            currentVisitorPhoto = samplePhoto;
            document.getElementById('photoPreview').innerHTML = `<img src="${samplePhoto}" alt="Visitor Photo">`;
            document.getElementById('photoPreview').classList.add('has-photo');
            
            showToast('Photo captured successfully!', 'success');
        }

        // Handle visitor details form submission
        document.getElementById('visitorDetailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const visitorName = document.getElementById('visitorNameDetails').value;
            const visitorEmail = document.getElementById('visitorEmail').value;
            
            // Generate visit code
            const visitCode = generateVisitCode();
            
            // Create structured QR code data
            const qrData = `VISITOR|${visitorName}|Unit ${Math.floor(Math.random() * 500 + 100)}|Personal Visit|${new Date().toISOString()}|${visitCode}`;
            
            // Create visitor record
            const visitor = {
                id: Date.now(),
                name: visitorName,
                email: visitorEmail,
                photo: currentVisitorPhoto,
                visitCode: visitCode,
                qrData: qrData, // Store the QR data for scanning
                timestamp: new Date().toISOString(),
                status: 'registered',
                type: 'visitor_details',
                purpose: 'Personal Visit'
            };
            
            registeredVisitors.unshift(visitor);
            
            // Add to activity log
            const activity = {
                id: Date.now(),
                type: 'pass_generated',
                category: 'visitor',
                person: visitorName,
                unit: 'N/A',
                timestamp: new Date().toISOString(),
                visitCode: visitCode
            };

            activityLog.unshift(activity);
            loadActivityFeed();
            loadTodayStats();
            
            showToast(`Visitor pass generated! Visit code: ${visitCode}`, 'success');
            closeVisitorModal();
        });

        // Handle car details form submission
        document.getElementById('carDetailsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const ownerName = document.getElementById('carOwnerName').value;
            const vehicleName = document.getElementById('vehicleName').value;
            const vehicleMaker = document.getElementById('vehicleMaker').value;
            const vehicleColor = document.getElementById('vehicleColor').value;
            const plateNumber = document.getElementById('plateNumber').value;
            
            // Generate visit code
            const visitCode = generateVisitCode();
            
            // Create structured QR code data with vehicle info
            const qrData = `VISITOR|${ownerName}|Unit ${Math.floor(Math.random() * 500 + 100)}|Vehicle Entry|${new Date().toISOString()}|${visitCode}|${plateNumber}`;
            
            // Create visitor record with car details
            const visitor = {
                id: Date.now(),
                name: ownerName,
                vehicleName: vehicleName,
                vehicleMaker: vehicleMaker,
                vehicleColor: vehicleColor,
                plateNumber: plateNumber,
                visitCode: visitCode,
                qrData: qrData, // Store the QR data for scanning
                timestamp: new Date().toISOString(),
                status: 'registered',
                type: 'car_details',
                purpose: 'Vehicle Entry'
            };
            
            registeredVisitors.unshift(visitor);
            
            // Add to activity log
            const activity = {
                id: Date.now(),
                type: 'pass_generated',
                category: 'visitor',
                person: ownerName,
                unit: 'N/A',
                timestamp: new Date().toISOString(),
                visitCode: visitCode,
                plateNumber: plateNumber
            };

            activityLog.unshift(activity);
            loadActivityFeed();
            loadTodayStats();
            
            showToast(`Vehicle pass generated! Visit code: ${visitCode}`, 'success');
            closeVisitorModal();
        });

        // Generate visit code
        function generateVisitCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // Open visitor scan modal
        function openVisitorScan() {
            document.getElementById('visitorScanModal').style.display = 'block';
            
            // Set current date and time
            const now = new Date();
            document.getElementById('visitDate').textContent = now.toLocaleString();
            
            // Clear any previous data
            document.getElementById('visitCode').value = '';
            document.getElementById('scanVisitorName').value = '';
            document.getElementById('scanPurpose').value = '';
            
            // Remove any previously added info divs
            const existingInfoDivs = document.querySelectorAll('.scan-form div[style*="margin: 0.5rem 0"]');
            existingInfoDivs.forEach(div => div.remove());
        }

        // Close visitor scan modal
        function closeVisitorScan() {
            document.getElementById('visitorScanModal').style.display = 'none';
            document.getElementById('visitCode').value = '';
            document.getElementById('scanVisitorName').value = '';
            document.getElementById('scanPurpose').value = '';
        }

        // Verify visitor
        function verifyVisitor() {
            const visitCode = document.getElementById('visitCode').value;
            const visitorName = document.getElementById('scanVisitorName').value;
            const purpose = document.getElementById('scanPurpose').value;
            
            if (!visitCode || !visitorName || !purpose) {
                showToast('Please fill in all required fields', 'warning');
                return;
            }
            
            // Find visitor record
            const visitor = registeredVisitors.find(v => v.visitCode === visitCode);
            
            if (visitor) {
                // Update visitor status
                visitor.status = 'verified';
                visitor.purpose = purpose;
                visitor.verifiedAt = new Date().toISOString();
                
                // Show visitor details
                showVisitorDetails(visitor);
            } else {
                // Create new visitor record for manual entry
                const newVisitor = {
                    id: Date.now(),
                    name: visitorName,
                    visitCode: visitCode,
                    purpose: purpose,
                    timestamp: new Date().toISOString(),
                    status: 'verified',
                    type: 'manual_entry'
                };
                
                registeredVisitors.unshift(newVisitor);
                showVisitorDetails(newVisitor);
            }
            
            // Add to activity log
            const activity = {
                id: Date.now(),
                type: 'entry',
                category: 'visitor',
                person: visitorName,
                unit: 'N/A',
                timestamp: new Date().toISOString(),
                visitCode: visitCode,
                purpose: purpose
            };

            activityLog.unshift(activity);
            loadActivityFeed();
            loadTodayStats();
            
            closeVisitorScan();
        }

        // Show visitor details
        function showVisitorDetails(visitor) {
            document.getElementById('visitorDetailsModal').style.display = 'block';
            
            // Set visitor photo
            const photoElement = document.getElementById('visitorDetailPhoto');
            if (visitor.photo) {
                photoElement.src = visitor.photo;
            } else {
                photoElement.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjM0I4MkY2Ii8+CjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjE4MCIgaGVpZ2h0PSIxMDAiIGZpbGw9IndoaXRlIiByeD0iNCIvPgo8Y2lyY2xlIGN4PSI1MCIgY3k9IjQwIiByPSIxNSIgZmlsbD0iI0U1RTdFQiIvPgo8cmVjdCB4PSI4MCIgeT0iMjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iOCIgZmlsbD0iIzM3NDE1MSIvPgo8cmVjdCB4PSI4MCIgeT0iMzUiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2IiBmaWxsPSIjNjQ3NDhCIi8+CjxyZWN0IHg9IjgwIiB5PSI0OCIgd2lkdGg9IjYwIiBoZWlnaHQ9IjYiIGZpbGw9IiM2NDc0OEIiLz4KPHR5cGUgeD0iMjAiIHk9Ijg1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiMzNzQxNTEiPklEIENBUkQ8L3RleHQ+Cjwvc3ZnPgo=';
            }
            
            // Set visitor details
            const verifiedTime = visitor.verifiedAt ? new Date(visitor.verifiedAt) : new Date();
            document.getElementById('visitorDetailEntryTime').textContent = verifiedTime.toLocaleTimeString();
            document.getElementById('visitorDetailName').textContent = visitor.name;
            document.getElementById('visitorDetailPurpose').textContent = visitor.purpose || 'Visit';
            document.getElementById('visitorDetailType').textContent = visitor.type === 'adhoc_visitor' ? 'Ad-hoc Visitor' : 'Pre-registered';
            
            // Store current visitor for the In button
            window.currentVisitorForEntry = visitor;
        }

        // Handle In button click
        function processVisitorEntry() {
            const visitor = window.currentVisitorForEntry;
            if (!visitor) {
                showToast('No visitor data available', 'warning');
                return;
            }
            
            // Update visitor status to "in"
            visitor.status = 'in';
            visitor.entryTime = new Date().toISOString();
            
            // Add to activity log
            const activity = {
                id: Date.now(),
                type: 'entry',
                category: 'visitor',
                person: visitor.name,
                unit: visitor.unit || 'N/A',
                timestamp: new Date().toISOString(),
                visitCode: visitor.visitCode,
                purpose: visitor.purpose || 'Visit',
                plateNumber: visitor.plateNumber
            };

            activityLog.unshift(activity);
            loadActivityFeed();
            loadTodayStats();
            
            // Update visitor in registered visitors array
            const visitorIndex = registeredVisitors.findIndex(v => v.id === visitor.id);
            if (visitorIndex !== -1) {
                registeredVisitors[visitorIndex] = visitor;
            }
            
            // Show success message
            showToast(`✅ ${visitor.name} has been logged IN`, 'success');
            
            // Close the modal
            closeVisitorDetails();
            
            // Update status indicator to show "IN"
            const statusIndicator = document.querySelector('.status-indicator');
            if (statusIndicator) {
                statusIndicator.className = 'status-indicator in';
                statusIndicator.innerHTML = '<i class="fas fa-sign-in-alt"></i> IN';
            }
        }

        // Close visitor details modal
        function closeVisitorDetails() {
            document.getElementById('visitorDetailsModal').style.display = 'none';
            window.currentVisitorForEntry = null;
        }

        // View visitor log (updated for new design)
        function openVisitorLog() {
            document.getElementById('visitorLogModal').style.display = 'block';
            loadVisitorList();
            updateVisitorCount();
        }

        // Close visitor log modal
        function closeVisitorLog() {
            document.getElementById('visitorLogModal').style.display = 'none';
        }

        // Load visitor list with new design
        function loadVisitorList() {
            const visitorList = document.getElementById('visitorList');
            const currentlyInList = document.getElementById('currentlyInList');
            
            // Filter currently in visitors
            const currentlyInVisitors = registeredVisitors.filter(visitor => 
                visitor.status === 'in' || visitor.status === 'verified'
            );
            
            // Load currently in visitors
            if (currentlyInVisitors.length === 0) {
                currentlyInList.innerHTML = `
                    <div style="text-align: center; color: #059669; padding: 1rem; font-style: italic;">
                        <i class="fas fa-check-circle"></i>
                        No visitors currently in the premises
                    </div>
                `;
            } else {
                currentlyInList.innerHTML = currentlyInVisitors.map(visitor => `
                    <div class="currently-in-item">
                        <div class="currently-in-avatar">
                            ${visitor.photo ? `<img src="${visitor.photo}" alt="Visitor">` : '<i class="fas fa-user"></i>'}
                        </div>
                        <div class="currently-in-details">
                            <div class="currently-in-name">${visitor.name}</div>
                            <div class="currently-in-time">Entry: ${visitor.entryTime ? new Date(visitor.entryTime).toLocaleString() : 'N/A'}</div>
                            <div class="currently-in-purpose">${visitor.purpose}</div>
                        </div>
                        <button class="mark-out-btn" onclick="markVisitorOut(${visitor.id})">
                            <i class="fas fa-sign-out-alt"></i>
                            Mark Out
                        </button>
                    </div>
                `).join('');
            }
            
            // Update currently in count
            document.getElementById('currentlyInCount').textContent = currentlyInVisitors.length;
            
            // Load all visitors (including ad-hoc visitors)
            if (registeredVisitors.length === 0) {
                visitorList.innerHTML = `
                    <div style="text-align: center; color: #64748b; padding: 2rem;">
                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">No visitors registered yet</div>
                        <div style="font-size: 0.9rem;">Register new visitors to see them here</div>
                    </div>
                `;
                return;
            }
            
            visitorList.innerHTML = registeredVisitors.map(visitor => `
                <div class="visitor-item" onclick="showVisitorDetails(${JSON.stringify(visitor).replace(/"/g, '&quot;')})">
                    <div class="visitor-avatar">
                        ${visitor.photo ? `<img src="${visitor.photo}" alt="Visitor">` : '<i class="fas fa-user"></i>'}
                    </div>
                    <div class="visitor-details">
                        <div class="visitor-name">${visitor.name}</div>
                        <div class="visitor-time">${new Date(visitor.timestamp).toLocaleString()}</div>
                        <div class="visitor-type">${visitor.type === 'adhoc_visitor' ? 'Ad-hoc Visitor' : 'Pre-registered'}</div>
                    </div>
                    <div class="visitor-status ${visitor.status === 'verified' ? 'in' : visitor.status === 'in' ? 'in' : 'registered'}">
                        <i class="fas ${getStatusIcon(visitor.status)}"></i>
                        ${getStatusText(visitor.status)}
                    </div>
                </div>
            `).join('');
        }

        // Mark visitor as out
        function markVisitorOut(visitorId) {
            const visitor = registeredVisitors.find(v => v.id === visitorId);
            if (!visitor) {
                showToast('Visitor not found', 'error');
                return;
            }
            
            // Update visitor status
            visitor.status = 'out';
            visitor.exitTime = new Date().toISOString();
            
            // Save to localStorage
            localStorage.setItem('registeredVisitors', JSON.stringify(registeredVisitors));
            
            // Add activity log entry
            const activityEntry = {
                id: Date.now(),
                type: 'visitor_exit',
                message: `${visitor.name} has left the premises`,
                timestamp: new Date().toISOString(),
                icon: 'fas fa-sign-out-alt',
                color: '#ef4444'
            };
            
            activityLog.unshift(activityEntry);
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Show success message
            showToast(`${visitor.name} marked as OUT`, 'success');
            
            // Immediately refresh both visitor lists
            loadVisitorList();
            updateVisitorCount();
            
            // Update activity feed if visible
            if (document.getElementById('activityFeed')) {
                loadActivityFeed();
            }
            
            // Force re-render of currently in section
            const currentlyInList = document.getElementById('currentlyInList');
            if (currentlyInList) {
                const currentlyInVisitors = registeredVisitors.filter(visitor => 
                    visitor.status === 'in' || visitor.status === 'verified'
                );
                
                if (currentlyInVisitors.length === 0) {
                    currentlyInList.innerHTML = `
                        <div style="text-align: center; color: #059669; padding: 1rem; font-style: italic;">
                            <i class="fas fa-check-circle"></i>
                            No visitors currently in the premises
                        </div>
                    `;
                } else {
                    currentlyInList.innerHTML = currentlyInVisitors.map(visitor => `
                        <div class="currently-in-item">
                            <div class="currently-in-avatar">
                                ${visitor.photo ? `<img src="${visitor.photo}" alt="Visitor">` : '<i class="fas fa-user"></i>'}
                            </div>
                            <div class="currently-in-details">
                                <div class="currently-in-name">${visitor.name}</div>
                                <div class="currently-in-time">Entry: ${visitor.entryTime ? new Date(visitor.entryTime).toLocaleString() : 'N/A'}</div>
                                <div class="currently-in-purpose">${visitor.purpose}</div>
                            </div>
                            <button class="mark-out-btn" onclick="markVisitorOut(${visitor.id})">
                                <i class="fas fa-sign-out-alt"></i>
                                Mark Out
                            </button>
                        </div>
                    `).join('');
                }
                
                // Update currently in count
                document.getElementById('currentlyInCount').textContent = currentlyInVisitors.length;
            }
        }

        // Update visitor count
        function updateVisitorCount() {
            document.getElementById('visitorCount').textContent = registeredVisitors.length;
        }

        // Get status icon
        function getStatusIcon(status) {
            const icons = {
                'registered': 'fa-user-plus',
                'verified': 'fa-check-circle',
                'in': 'fa-sign-in-alt',
                'out': 'fa-sign-out-alt'
            };
            return icons[status] || 'fa-user';
        }

        // Get status text
        function getStatusText(status) {
            const texts = {
                'registered': 'REGISTERED',
                'verified': 'VERIFIED',
                'in': 'IN',
                'out': 'OUT'
            };
            return texts[status] || 'REGISTERED';
        }

        // Open QR Scanner in Log Modal
        function openQRScannerInLog() {
            document.getElementById('qrScannerInLogModal').style.display = 'block';
            startQRScannerInLog();
        }

        // Close QR Scanner in Log Modal
        function closeQRScannerInLog() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch(err => console.log('Scanner stop error:', err));
            }
            document.getElementById('qrScannerInLogModal').style.display = 'none';
        }

        // Start QR Scanner in Log Modal
        function startQRScannerInLog() {
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };

            html5QrcodeScanner = new Html5Qrcode("readerInLog");
            
            html5QrcodeScanner.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                    handleScanSuccess(decodedText);
                    closeQRScannerInLog();
                },
                (errorMessage) => {
                    // Handle scan errors silently
                }
            ).catch(err => {
                console.log('Scanner start error:', err);
                showToast('Camera not available. Please use file upload.', 'warning');
            });
        }

        // Load activity feed
        function loadActivityFeed() {
            const feed = document.getElementById('activityFeed');
            const recentActivities = activityLog.slice(0, 10); // Show last 10 activities
            
            if (recentActivities.length === 0) {
                feed.innerHTML = `
                    <div style="text-align: center; color: #64748b; padding: 2rem;">
                        <i class="fas fa-shield-alt" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <div style="font-size: 1.1rem; margin-bottom: 0.5rem;">No Recent Activity</div>
                        <div style="font-size: 0.9rem;">Activity will appear here as people enter and exit</div>
                    </div>
                `;
                return;
            }

            feed.innerHTML = recentActivities.map(activity => `
                <div class="activity-item ${activity.type}">
                    <div class="activity-icon ${activity.type}">
                        <i class="fas ${getActivityIcon(activity.type)}"></i>
                    </div>
                    <div class="activity-details">
                        <div class="activity-person">${activity.person}</div>
                        <div class="activity-description">${getActivityDescription(activity)}</div>
                    </div>
                    <div class="activity-time">
                        ${new Date(activity.timestamp).toLocaleTimeString()}
                    </div>
                </div>
            `).join('');
        }

        // Get activity icon
        function getActivityIcon(type) {
            const icons = {
                'entry': 'fa-arrow-right',
                'exit': 'fa-arrow-left',
                'alert': 'fa-exclamation-triangle',
                'pass_generated': 'fa-id-card'
            };
            return icons[type] || 'fa-circle';
        }

        // Get activity description
        function getActivityDescription(activity) {
            switch(activity.type) {
                case 'entry':
                    return `Entered building • ${activity.unit}`;
                case 'exit':
                    return `Exited building • ${activity.unit}`;
                case 'pass_generated':
                    return `Visitor pass generated • ${activity.unit} • ${activity.purpose}`;
                case 'alert':
                    return `Security alert triggered`;
                default:
                    return 'Activity logged';
            }
        }

        // Other quick actions
        function logIncident() {
            const description = prompt('Enter incident description:');
            if (description) {
                const activity = {
                    id: Date.now(),
                    type: 'alert',
                    category: 'incident',
                    person: 'Security Guard',
                    unit: 'N/A',
                    timestamp: new Date().toISOString(),
                    description: description
                };

                activityLog.unshift(activity);
                loadActivityFeed();
                loadTodayStats();
                showToast('Incident logged successfully', 'success');
            }
        }

        function triggerEmergency() {
            if (confirm('Trigger emergency alert?')) {
                const activity = {
                    id: Date.now(),
                    type: 'alert',
                    category: 'emergency',
                    person: 'Security Guard',
                    unit: 'Security Desk',
                    timestamp: new Date().toISOString(),
                    description: 'Emergency alert triggered'
                };

                activityLog.unshift(activity);
                loadActivityFeed();
                loadTodayStats();
                showToast('🚨 Emergency alert sent!', 'warning');
            }
        }

        // Toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#3b82f6';
            
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                z-index: 10000;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Switch scanner mode
        function switchScannerMode(mode) {
            currentScannerMode = mode;
            
            // Update tab styles
            document.getElementById('qrModeTab').classList.toggle('active', mode === 'qr');
            document.getElementById('ocrModeTab').classList.toggle('active', mode === 'ocr');
            
            // Update instructions
            const instructions = document.getElementById('scannerInstructions');
            if (mode === 'qr') {
                instructions.textContent = 'Position QR code within the scanning area';
            } else {
                instructions.textContent = 'Position ID card within the scanning area';
            }
            
            // Restart scanner with new mode
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    startScanner();
                });
            }
        }

        // OCR Scanner Functions
        function openOCRScanner() {
            document.getElementById('ocrScannerModal').style.display = 'block';
            startOCRScanner();
        }

        function closeOCRScanner() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch(err => console.log('Scanner stop error:', err));
            }
            document.getElementById('ocrScannerModal').style.display = 'none';
        }

        function startOCRScanner() {
            const config = {
                fps: 10,
                qrbox: { width: 300, height: 200 },
                aspectRatio: 1.5
            };

            html5QrcodeScanner = new Html5Qrcode("ocrReader");
            
            html5QrcodeScanner.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                    // Simulate OCR processing
                    simulateOCRProcessing(decodedResult);
                },
                (errorMessage) => {
                    // Handle scan errors silently
                }
            ).catch(err => {
                console.log('Scanner start error:', err);
                showToast('Camera not available. Please use file upload.', 'warning');
            });
        }

        function simulateOCRProcessing(scanResult) {
            // Show processing indicator
            showToast('Processing ID card...', 'info');
            
            // Simulate OCR processing delay
            setTimeout(() => {
                const idData = extractIDCardData(scanResult);
                displayIDCardDetails(idData);
                closeOCRScanner();
            }, 2000);
        }

        function extractIDCardData(scanResult) {
            // Simulate extracting data from ID card
            const sampleNames = [
                'Juan Dela Cruz Santos',
                'Maria Garcia Rodriguez',
                'Pedro Martinez Lopez',
                'Ana Fernandez Torres',
                'Carlos Ramirez Vega'
            ];
            
            const sampleAddresses = [
                '123 Magsaysay St., Quezon City, Metro Manila',
                '456 Rizal Ave., Makati City, Metro Manila',
                '789 Bonifacio St., Manila, Metro Manila',
                '321 Aguinaldo St., Pasig City, Metro Manila',
                '654 Mabini St., Taguig City, Metro Manila'
            ];
            
            const sampleIDNumbers = [
                '1234-5678-9012-3456',
                '2345-6789-0123-4567',
                '3456-7890-1234-5678',
                '4567-8901-2345-6789',
                '5678-9012-3456-7890'
            ];
            
            const randomIndex = Math.floor(Math.random() * 5);
            
            return {
                fullName: sampleNames[randomIndex],
                address: sampleAddresses[randomIndex],
                dateOfBirth: generateRandomDate(),
                idNumber: sampleIDNumbers[randomIndex],
                nationality: 'Filipino',
                idType: 'National ID',
                photo: generateRandomPhoto()
            };
        }

        function generateRandomDate() {
            const start = new Date(1960, 0, 1);
            const end = new Date(2000, 11, 31);
            const randomDate = new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
            return randomDate.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function generateRandomPhoto() {
            const photos = [
                'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=200&fit=crop&crop=face',
                'https://images.unsplash.com/photo-1494790108755-2616b612b786?w=150&h=200&fit=crop&crop=face',
                'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=200&fit=crop&crop=face',
                'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=200&fit=crop&crop=face',
                'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=200&fit=crop&crop=face'
            ];
            return photos[Math.floor(Math.random() * photos.length)];
        }

        function displayIDCardDetails(idData) {
            // Populate ID card details
            document.getElementById('idPhoto').src = idData.photo;
            document.getElementById('idName').textContent = idData.fullName;
            document.getElementById('idNumber').textContent = idData.idNumber;
            document.getElementById('idType').textContent = idData.idType;
            document.getElementById('fullName').textContent = idData.fullName;
            document.getElementById('address').textContent = idData.address;
            document.getElementById('dateOfBirth').textContent = idData.dateOfBirth;
            document.getElementById('idNumberDetail').textContent = idData.idNumber;
            document.getElementById('nationality').textContent = idData.nationality;
            
            // Store ID data for registration
            window.currentIDData = idData;
            
            // Show modal
            document.getElementById('idCardDetailsModal').style.display = 'block';
        }

        function closeIDCardDetails() {
            document.getElementById('idCardDetailsModal').style.display = 'none';
            window.currentIDData = null;
        }

        function registerFromIDCard() {
            if (!window.currentIDData) {
                showToast('No ID data available', 'error');
                return;
            }
            
            // Create visitor from ID data
            const visitor = {
                id: Date.now(),
                name: window.currentIDData.fullName,
                phone: 'N/A',
                purpose: 'Ad-hoc Visitor',
                type: 'adhoc_visitor',
                photo: window.currentIDData.photo,
                timestamp: new Date().toISOString(),
                status: 'registered',
                entryTime: null,
                exitTime: null,
                idNumber: window.currentIDData.idNumber,
                address: window.currentIDData.address,
                dateOfBirth: window.currentIDData.dateOfBirth,
                nationality: window.currentIDData.nationality
            };
            
            // Add to registered visitors
            registeredVisitors.push(visitor);
            localStorage.setItem('registeredVisitors', JSON.stringify(registeredVisitors));
            
            // Update dashboard stats
            updateDashboardStats();
            
            // Show success message
            showToast('Visitor registered successfully!', 'success');
            
            // Close modal
            closeIDCardDetails();
            
            // Refresh visitor log if open
            if (document.getElementById('visitorLogModal').style.display === 'block') {
                loadVisitorList();
                updateVisitorCount();
            }
        }

        function demoOCRScan() {
            // Show processing indicator
            showToast('Processing ID card...', 'info');
            
            // Simulate OCR processing delay
            setTimeout(() => {
                const idData = extractIDCardData({});
                displayIDCardDetails(idData);
                showToast('Demo scan completed!', 'success');
                closeOCRScanner(); // Close the scanner modal
            }, 2000);
        }

        // Open QR Scanner in Pre-Registered Modal
        function openQRScannerInPreRegistered() {
            document.getElementById('qrScannerInPreRegisteredModal').style.display = 'block';
            startQRScannerInPreRegistered();
        }

        // Close QR Scanner in Pre-Registered Modal
        function closeQRScannerInPreRegistered() {
            if (html5QrcodeScanner) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                }).catch(err => console.log('Scanner stop error:', err));
            }
            document.getElementById('qrScannerInPreRegisteredModal').style.display = 'none';
        }

        // Start QR Scanner in Pre-Registered Modal
        function startQRScannerInPreRegistered() {
            const config = {
                fps: 10,
                qrbox: { width: 250, height: 250 },
                aspectRatio: 1.0
            };

            html5QrcodeScanner = new Html5Qrcode("readerInPreRegistered");
            
            html5QrcodeScanner.start(
                { facingMode: "environment" },
                config,
                (decodedText, decodedResult) => {
                    handleScanSuccess(decodedText);
                    closeQRScannerInPreRegistered();
                },
                (errorMessage) => {
                    // Handle scan errors silently
                }
            ).catch(err => {
                console.log('Scanner start error:', err);
                showToast('Camera not available. Please use file upload.', 'warning');
            });
        }

        // Pre-Registered Visitors Functions
        function openPreRegisteredLog() {
            document.getElementById('preRegisteredModal').style.display = 'block';
            loadPreRegisteredList();
            updatePreRegisteredCount();
        }

        function closePreRegisteredLog() {
            document.getElementById('preRegisteredModal').style.display = 'none';
        }

        function loadPreRegisteredList() {
            const preRegisteredList = document.getElementById('preRegisteredList');
            
            // Filter pre-registered visitors (not ad-hoc)
            const preRegisteredVisitors = registeredVisitors.filter(visitor => 
                visitor.type !== 'adhoc_visitor'
            );
            
            if (preRegisteredVisitors.length === 0) {
                preRegisteredList.innerHTML = `
                    <div style="text-align: center; color: #64748b; padding: 2rem;">
                        <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">No pre-registered visitors</div>
                        <div style="font-size: 0.9rem;">Register new visitors to see them here</div>
                    </div>
                `;
                return;
            }
            
            preRegisteredList.innerHTML = preRegisteredVisitors.map(visitor => `
                <div class="visitor-item" onclick="showVisitorDetails(${JSON.stringify(visitor).replace(/"/g, '&quot;')})">
                    <div class="visitor-avatar">
                        ${visitor.photo ? `<img src="${visitor.photo}" alt="Visitor">` : '<i class="fas fa-user"></i>'}
                    </div>
                    <div class="visitor-details">
                        <div class="visitor-name">${visitor.name}</div>
                        <div class="visitor-time">${new Date(visitor.timestamp).toLocaleString()}</div>
                        <div class="visitor-type">Pre-registered</div>
                    </div>
                    <div class="visitor-status ${visitor.status === 'verified' ? 'in' : visitor.status === 'in' ? 'in' : 'registered'}">
                        <i class="fas ${getStatusIcon(visitor.status)}"></i>
                        ${getStatusText(visitor.status)}
                    </div>
                </div>
            `).join('');
        }

        function updatePreRegisteredCount() {
            const preRegisteredVisitors = registeredVisitors.filter(visitor => 
                visitor.type !== 'adhoc_visitor'
            );
            document.getElementById('preRegisteredCount').textContent = preRegisteredVisitors.length;
        }
    </script>
</body>
</html> 